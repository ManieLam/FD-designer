

# 表单模型

1. 从布局上：常规流式、网格、多栏、表格、多字段区域组合
2. 从数据上：
   - 根据路由参数/其他表单带入的需要在起初发起请求获取数据 （编辑、步骤）
   - 无默认数据表单，简单增删改，数据提交，再跳转到指定位置 （问卷）

# 画布


## 预览
1. 拼接完的代码页面预览？直接页面效果预览？
2. 从配置json中抽取信息
3. mounted 封装 --- 哪些是需要在表单首次加载完成的：默认值填充、发起加载请求、relation默认加载 （目前数据请求跨域问题，暂时使用mock，但是实际在项目中使用时，需要考虑）；如何获取配置的所有数据源？ 【ok】
4. 表单其他行为执行
5. 校验封装
6. 联动触发、行为触发

### 直接预览页面效果
> 
> 输入：config.json；输出：.vue文件
>
> 事件处理 - mounted封装【表单初始化时的行为执行】；联动效果处理；请求模拟数据、模拟填值状态；
> 
> 属性处理 - form属性、form-item属性 转换为anso-ui/ansoDataform 支持的配置
> > 校验：rules<Object\>转为rules<Array\>；
> >
> > 选项：根据optionType类型选择options/optionsAsyncFunc赋值；存在异步取值
> >
> > 默认值：根据defaultValue.valueType取值；如果valueType==='isPreset'则为默认取值
> >
> > 搜索：根据filterAbleType类型选择, 存在异步搜索
> 
> 增加表单子组件类型，有相应新的属性需要转换，需要在预览中增加解译操作

### 导出文件
- json配置文件
- vue文件
- html文件

### 编译/使用

#### 用于二次开发
  > 首先获取配置文件：导出的.json文件（多个，一个画布相当于一个组件）
 * 使用方法一（TODO）：install -- 搭配main.js中vue.use()
 * 使用方法二：全局异步注册模板组件 + 使用
  ``` js
   // 步骤一：main.js
   import { registerModules } from 'FDTranslator'
   registerModules(Vue)
   // 步骤二：实际应用的项目页面
   import { templateRegister } from 'FDTranslator'
    // 调用配置文件（略）
    // 获取模板组件
   this.compName = templateRegister[配置.template]
    // 使用动态组件加载
   component(:is="compName", :config="配置")

   // TODO 还需要对工具方法/类的转出？
  ```

​	TODO 需要默认加载一些utils工具函数



 * 使用方法三（TODO）：路由() => import(''), 直接引入使用
 * 使用方法四（TODO）：Vue.compile( template ) 渲染模板

  > 导出.vue文件，直接按需使用

#### 直接使用
> 导出 .html/.js 文件（多个, 一个画布一个文件）

- 利用blob数据转换，生成html对象
- 单独指定文件打包

------
# 全局配置
## 数据源配置
1. 请求地址 🆗

2. 请求方式

   - 手动配置 🆗
     - 全局导入 TODO 

3. 请求头部

     - 手动配置 🆗
     - 全局导入 TODO 
4. 请求参数
     - 动态数据源 获取指定参数（表单数据/路由数据/本地缓存） = 当body中变量类型value存在`${row.varType}|${row.value}`这个格式 需要转换成动态取值 🆗
     - 地址栏动态参数配置，如：http://localhost:11011/api/area/23/user/1111111?orgin=123&timeStamp=1668495558905，其中【23，11111】为动态参数，在配置中显示为：http://localhost:11011/api/area/${area}/user/${userCode}?orgin=123&timeStamp=1668495558905。其中${area}和${userCode}需要在【请求参数(path)】中配置指定的数据源 🆗
     - 地址栏中出现【${}】的符号，则动态在【请求参数(path)】中对应生成参数行。
     - 全局导入 TODO
5. 数据处理 提交前
     - 动态数据源 请求参数自定义 🆗

6. 数据处理 数据返回数据响应时

     - 自定义 🆗
     - 当修改响应返回的数据格式，赋值问题需要处理 （TODO）
7. 数据处理 异常数据处理
     - 自定义 🆗
8. 备注
9. 全局导入数据源

     - 开放导入 TODO
     - 模拟导入 🆗

10. 测试链接
     - 弹窗显示测试结果 TODO （目前直接在控制台查看） 
11. 多数据源配置

     - 方式：并行, 串行, xx条件执行A、xx条件执行B
     - 条件：
          ```
          根据返回的请求数据？一般A接口返回的数据作为B发起的参数，成立吗，那直接将A的请求参数放到B发起时候带过去，不就可以？场景：
               A1 -> A1 === 1 ? B1 : B2
               A2 -> A2 ===2 && A1 === 1 ? B1 : B2
               A1 满足再次发起条件 ？ 执行B1 ：关闭请求 ---- 下一步操作者/判断业务是否有锁定，未锁定业务可以办理

          设置表单默认数据源? 将请求回来的数据参数分组成表单的多份数据集合，在配置默认值的时候，通过【数据集合名.字段名】的方式设置 --- 接口必须设置name,用于标识数据集合，【name唯一性】
          ```

## 组件拖拽
1. 拖拽顺序 - 需要默认追尾: 已完成随意拖拽存放的位置，不做默认追尾。
2. 拖拽过程的取消拖拽 TODO

--------
# 表单配置
## 属性
1. 只读 ok
2. 表单标题 TODO
3. 布局类型 TODO
4. 文本标签宽度 ok
5. 文本显示位置 ok
6. 保留数据输入/缓存数据 TODO
7. 自动聚焦 TODO
8. 回车提交表单 TODO

## 行为
1. 初始化时加载字段字典

     - 配置数据源
     - 
2. 获取初始化数据

     - 前置触发条件 TODO

     - 配置数据源 🆗

     - 数据获取后赋值操作 🆗

     - 动态数据源 带定值参数/请求参数自定义 🆗

     - 动态数据源 获取指定参数（表单数据/路由数据/本地缓存） TODO

3. 提交按钮

     - 提交前校验 🆗
     - 提交前数据处理
     - 提交后操作 通过emit通知外部 🆗
     - 提交事件 可配置/规则设计 TODO
     - 
4. 取消按钮

     - 取消前二次提醒 🆗 （TODO: bug 弹窗层级问题）
     - 关闭弹窗 🆗
     - 返回上一页 🆗
     - 
5. 重置按钮

     - 重置前二次提醒 🆗

     - 清空数据 🆗

6. 自定义按钮 TODO


--------

# 组件配置
## select
### 选项
1. 手动添加 🆗
2. 动态字典 🆗
3. 动态数据源
     - 配置/解译 🆗

### 分组（TODO）
1. 支持的分组方式：anso-ui 支持根据选项中某个属性值分组

2. 自定义分组名称

### 多选 （TODO）
1. 数据结构问题处理，单选时候需要String或Number，多选时候，需要允许Array
2. 
### 搜索
1. 静态搜索 🆗
2. 远程搜索

     - 配置 🆗

     - 解译 （TODO），涉及在原先组件的基础上无法实现 

### 验证
1. 选中任何种校验规则，都允许各自配置，并写入storage
2. 可以多选规则
3. 点击保存+刷新，同步与视图区数据交互
4. 自定义规则String转换Function，并成功运行

### 默认值
1. 默认配置同名取值，可以在请求数据后，自动赋值 🆗
2. 配置指定localstorage的名称，暂不支持取值为对象类型，取值后能成功赋值 TODO
3. 指定获取地址栏数据，自动赋值 TODO
4. 指定根据表单内数据自定义运算　TODO
5. 指定关联字段及配置的相关行为　TODO
   
> props:
> >  value：defaultValue --- 实际数值
> >  valueType：defaultValueType --- 默认取值类型
> >  presetType: ---- 预设数据可选项


### 手写代码
  - 选项
  - 配置数据源
  - 配置默认值（可由表单配置中的【初始化-发起请求】中处理；暂时不做解译）
    ```
    (data, fields, field) => {
      // 一般参与计算的有：fields[field.name].options、data[某个字段]
      return data[field.name]
    }
    ```

-------------
# 数据接口常用
至少返回层级到code、message、data
```
- 列表/relation:
{
  code: 0,
  message: '',
  data: {
    data: [{ name: 'relation字典名称', desc: '' }],
    total: 1
  }
}

- 新增/编辑/删除
{
  code: 0,
  message: '',
  data: null
}

- 详情
{
  code: 0,
  message: '',
  data: {}
} 

```


-------------

# 问题/TODO
1. 手填的一些属性值没有数据格式限定
2. 增加表单内字段分组的概念 ---- 分组名称、分组排序
3. 增加表单按钮配置属性 --- 按钮数量、单按钮属性、位置
4. 增加表单底部自定义、顶部自定义，选中则在左边高亮显示区域？
5. 切换【组件/表单配置区】希望左边能显示高亮 ok
6. 插槽的开放，允许插入自定义组件

--------------
# 场景演示
1. 提交数据 - 动态数据源 获取指定参数（表单数据）
2. 增加Text和input类型的组件
3. 取消按钮，分关闭页面/分关闭弹窗 ok
4. 

----
# 其他类似概念的低代码搭建平台
1. 百度 - 爱速搭（商用需要收费）、[amis](https://baidu.github.io/amis/zh-CN/docs/index) - 基于react开发，如产品项目需要二次开发需要使用react，[关于vue的使用](https://github.com/baidu/amis/issues/31)
2. jeecgBoot（包含前后端+搭建工具 - 收费）

# 代码编辑器
1. monaco-editor
